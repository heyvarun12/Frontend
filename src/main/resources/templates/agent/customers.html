<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assigned Customers - HIMS Agent Portal</title>
      <link rel="icon" href="/assets/logo.svg" type="image/svg+xml">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; overflow-x: hidden; }

        /* Sidebar Nav Styles */
        .nav-active { 
            background: linear-gradient(to right, rgba(16, 185, 129, 0.1), rgba(20, 184, 166, 0.1)); 
            color: #059669; 
            font-weight: 600;
        }

        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }

        /* Modal Styles */
        .hidden-modal { display: none !important; }
        .modal-backdrop {
            background-color: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(8px);
            z-index: 100;
        }

        /* Status Badge Colors */
        .badge-active { background: #dcfce7; color: #15803d; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-inactive { background: #f1f5f9; color: #64748b; }
    </style>
</head>
<body class="flex min-h-screen">

   <header id="mobileHeader"
  class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 z-30 lg:hidden">

  <a href="#"
     class="flex items-center gap-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
     aria-label="HIMS Agent Portal Home">
    <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center">
      <i data-lucide="shield" class="w-5 h-5 text-white"></i>
    </div>
    <span class="text-lg font-bold text-gray-900">HIMS Agent</span>
  </a>

  <button onclick="toggleSidebar(true)"
    class="p-2 rounded-lg hover:bg-gray-100"
    aria-label="Open navigation menu">
    <i data-lucide="menu" class="w-6 h-6"></i>
  </button>
</header>

<!-- ===== Mobile Overlay ===== -->
<div id="sidebarOverlay"
  class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"
  onclick="toggleSidebar(false)">
</div>

<!-- ===== Sidebar (AgentSidebar) ===== -->
<aside id="agentSidebar"
  class="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50
         transition-transform duration-300 ease-in-out
         -translate-x-full lg:translate-x-0">

  <!-- Header -->
  <div class="p-6 border-b border-gray-200">
    <div class="flex items-center justify-between">
      <a href="#"
         class="flex items-center gap-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
         aria-label="HIMS Agent Portal Home">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center">
          <i data-lucide="shield" class="w-6 h-6 text-white"></i>
        </div>
        <div>
          <span class="text-lg font-bold text-gray-900">HIMS</span>
          <p class="text-xs text-gray-500">Agent Portal</p>
        </div>
      </a>

      <!-- Close (mobile) -->
      <button onclick="toggleSidebar(false)"
        class="lg:hidden p-2 rounded-lg hover:bg-gray-100"
        aria-label="Close navigation">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 px-4 py-4 space-y-1" aria-label="Main menu">

    <!-- Agent Dashboard -->
    <a th:href="@{/agent/dashboard}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             text-gray-500 hover:text-gray-900 hover:bg-gray-100
             transition-all duration-200">
      <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
      <span>Agent Dashboard</span>
    </a>

    <!-- Policies -->
    <a th:href="@{/agent/policies}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             text-gray-500 hover:text-gray-900 hover:bg-gray-100
             transition-all duration-200"
      aria-current="page">
      <i data-lucide="file-text" class="w-5 h-5"></i>
      <span>Policies</span>
    </a>

    <!-- Claims -->
    <a th:href="@{/agent/claims}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             text-gray-500 hover:text-gray-900 hover:bg-gray-100
             transition-all duration-200">
      <i data-lucide="clipboard-list" class="w-5 h-5"></i>
      <span>Claims</span>
    </a>

    <!-- Customers (ACTIVE) -->
    <a th:href="@{/agent/customers}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             bg-gradient-to-r from-emerald-500/10 to-teal-600/10
             text-emerald-600 font-medium
             transition-all duration-200">
      <i data-lucide="user" class="w-5 h-5"></i>
      <span>Customers</span>
    </a>

    <!-- Support -->
    <a th:href="@{/agent/support}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             text-gray-500 hover:text-gray-900 hover:bg-gray-100
             transition-all duration-200">
      <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
      <span>Support</span>
    </a>

    <!-- Profile -->
    <a th:href="@{/agent/profile}"
      class="flex items-center gap-3 px-4 py-3 rounded-xl
             text-gray-500 hover:text-gray-900 hover:bg-gray-100
             transition-all duration-200">
      <i data-lucide="user" class="w-5 h-5"></i>
      <span>Profile</span>
    </a>

  </nav>

  <!-- Logout -->
  <div class="p-4 border-t border-gray-200">
    <button onclick="logout()"
      class="flex items-center gap-3 px-4 py-3 w-full rounded-xl
             text-red-600 hover:bg-red-50
             transition-all duration-200">
      <i data-lucide="log-out" class="w-5 h-5"></i>
      <span>Logout</span>
    </button>
  </div>
</aside>

    <main class="lg:ml-64 flex-1 p-4 sm:p-8 pt-20 lg:pt-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-slate-900 mb-2">Assigned Customers</h1>
            <p class="text-slate-500 font-medium">View and manage customers assigned to you</p>
        </header>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-4 rounded-xl border border-slate-200 text-center card-hover">
                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-2 text-emerald-600">
                    <i data-lucide="user" class="w-5 h-5"></i>
                </div>
                <p class="text-2xl font-bold text-emerald-600" th:text="${statActive}">0</p>
                <p class="text-sm text-slate-500 font-medium">Active</p>
            </div>
            <div class="bg-white p-4 rounded-xl border border-slate-200 text-center card-hover">
                <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-2 text-amber-600">
                    <i data-lucide="user" class="w-5 h-5"></i>
                </div>
                <p class="text-2xl font-bold text-amber-600" th:text="${statPending}">0</p>
                <p class="text-sm text-slate-500 font-medium">Pending</p>
            </div>
            <div class="bg-white p-4 rounded-xl border border-slate-200 text-center card-hover">
                <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-2 text-slate-600">
                    <i data-lucide="user" class="w-5 h-5"></i>
                </div>
                <p class="text-2xl font-bold text-slate-600" th:text="${statInactive}">0</p>
                <p class="text-sm text-slate-500 font-medium">Inactive</p>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <div class="relative flex-1 max-w-md">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                <input type="text" id="customerSearch" oninput="renderCustomers()" placeholder="Search by name, email, or phone..." class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-2xl text-sm focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all">
            </div>
            <select id="statusFilter" onchange="renderCustomers()" class="w-full sm:w-48 bg-white border border-slate-200 rounded-2xl px-4 py-3 text-sm font-bold text-slate-600 outline-none transition-all">
                <option value="all">All Customers</option>
                <option value="active">Active</option>
                <option value="pending">Pending</option>
                <option value="inactive">Inactive</option>
            </select>
        </div>

        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50/50 text-slate-400 text-[11px] font-bold uppercase tracking-widest border-b border-slate-100">
                        <tr>
                            <th class="px-6 py-4">Customer</th>
                            <th class="px-6 py-4 hidden sm:table-cell">Email</th>
                            <th class="px-6 py-4 hidden md:table-cell">Phone</th>
                            <th class="px-6 py-4 hidden lg:table-cell">Joined</th>
                            <th class="px-6 py-4">Status</th>
                            <th class="px-6 py-4 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody" class="divide-y divide-slate-50 text-sm">
                        <tr th:each="u : ${customers}" class="hover:bg-slate-50/80 transition-colors group">
                            <td class="px-6 py-4 flex items-center gap-3 font-bold text-slate-800">
                                <div class="w-9 h-9 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center text-white text-[10px] shadow-sm" th:text="${u.username != null and u.username.length() > 0 ? u.username.substring(0,1).toUpperCase() : 'U'}">J</div>
                                <div>
                                    <p th:text="${u.username}">John Doe</p>
                                    <div class="flex gap-2 text-[10px] text-slate-400 font-medium uppercase">
                                        <span th:text="${#lists.size(policyService.findByUser(u)) + ' policies'}">0 policies</span> • <span th:text="${0 + ' claims'}">0 claims</span>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-slate-500 font-medium hidden sm:table-cell" th:text="${u.email}">john@example.com</td>
                            <td class="px-6 py-4 text-slate-500 font-medium hidden md:table-cell">—</td>
                            <td class="px-6 py-4 text-slate-400 text-xs hidden lg:table-cell font-medium">—</td>
                            <td class="px-6 py-4">
                                <span th:class="${#lists.isEmpty(policyService.findByUser(u)) ? 'badge-pending' : 'badge-active'} + ' px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest'" th:text="${#lists.isEmpty(policyService.findByUser(u)) ? 'Pending' : 'Active'}">Active</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex justify-end gap-1">
                                    <a th:href="@{/agent/customers/{id}(id=${u.id})}" class="p-2 text-slate-300 hover:text-slate-600 transition-colors"><i data-lucide="eye" class="w-5 h-5"></i></a>
                                    <button class="p-2 text-slate-300 hover:text-emerald-600 transition-colors"><i data-lucide="mail" class="w-5 h-5"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${customers == null || customers.size() == 0}" class="text-sm text-muted">
                            <td colspan="6" class="px-6 py-6 text-center">No customers found</td>
                        </tr>
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="customerModal" class="hidden-modal fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[32px] shadow-2xl relative overflow-hidden">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-300 hover:text-slate-600 transition-colors z-20">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div class="p-10 max-h-[85vh] overflow-y-auto">
                <h3 class="text-2xl font-bold mb-8">Customer Details</h3>
                
                <div class="flex items-center gap-4 mb-8">
                    <div id="m-avatar" class="w-16 h-16 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center text-white text-xl font-bold shadow-lg"></div>
                    <div>
                        <h4 id="m-name" class="text-xl font-bold text-slate-900"></h4>
                        <span id="m-status-badge" class="text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-widest"></span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-y-6 mb-8 border-t border-slate-50 pt-8">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Email Address</p>
                        <div class="flex items-center gap-2 text-sm font-medium text-slate-700">
                            <i data-lucide="mail" class="w-3.5 h-3.5"></i> <span id="m-email"></span>
                        </div>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Phone Number</p>
                        <div class="flex items-center gap-2 text-sm font-medium text-slate-700">
                            <i data-lucide="phone" class="w-3.5 h-3.5"></i> <span id="m-phone"></span>
                        </div>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Member Since</p>
                        <div class="flex items-center gap-2 text-sm font-medium text-slate-700">
                            <i data-lucide="calendar" class="w-3.5 h-3.5"></i> <span id="m-joined"></span>
                        </div>
                    </div>
                </div>

                <div class="mb-8 border-t border-slate-50 pt-8">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Linked Policies</p>
                    <div id="m-policies-list" class="space-y-3"></div>
                </div>

                <div class="flex gap-4 border-t border-slate-50 pt-8">
                    <button class="flex-1 bg-slate-50 border border-slate-100 font-bold py-4 rounded-2xl text-xs text-slate-700 hover:bg-slate-100 flex items-center justify-center gap-2">
                        <i data-lucide="mail" class="w-4 h-4"></i> Send Email
                    </button>
                    <button class="flex-1 bg-emerald-500 text-white font-bold py-4 rounded-2xl text-xs shadow-lg shadow-emerald-100 hover:opacity-90 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i> View Policies
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data mirroring the mockData
        const customers = [
            { id: 'USR-001', full_name: 'John Doe', email: 'john@example.com', phone: '+1 555-0100', status: 'active', created_at: '2024-01-15' },
            { id: 'USR-002', full_name: 'Jane Smith', email: 'jane@example.com', phone: '+1 555-0101', status: 'active', created_at: '2024-02-20' },
            { id: 'USR-003', full_name: 'Mike Johnson', email: 'mike@example.com', phone: '+1 555-0102', status: 'pending', created_at: '2024-03-10' },
            { id: 'USR-004', full_name: 'Robert Brown', email: 'robert@example.com', phone: '+1 555-0104', status: 'active', created_at: '2024-04-05' }
        ];

        const policies = [
            { id: 'POL-001', holder_name: 'John Doe', name: 'Health Plus Premium', status: 'active' },
            { id: 'POL-002', holder_name: 'Jane Smith', name: 'Dental Care Basic', status: 'active' },
            { id: 'POL-003', holder_name: 'Mike Johnson', name: 'Vision Care', status: 'inactive' }
        ];

        const claims = [
            { id: 'CLM-002', holder_name: 'John Doe', type: 'Lab Tests', status: 'pending' }
        ];

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
            document.getElementById('sidebarOverlay').classList.toggle('hidden');
        }

        function renderCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const body = document.getElementById('customerTableBody');
            
            const filtered = customers.filter(u => {
                const matchesSearch = u.full_name.toLowerCase().includes(searchTerm) || u.email.toLowerCase().includes(searchTerm) || u.phone.includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || u.status === statusFilter;
                return matchesSearch && matchesStatus;
            });

            // Update stats
            document.getElementById('stat-active').innerText = customers.filter(c => c.status === 'active').length;
            document.getElementById('stat-pending').innerText = customers.filter(c => c.status === 'pending').length;
            document.getElementById('stat-inactive').innerText = customers.filter(c => c.status === 'inactive').length;

            body.innerHTML = filtered.map(u => {
                const initials = u.full_name.split(" ").map(n => n[0]).join("");
                const userPolicies = policies.filter(p => p.holder_name === u.full_name).length;
                const userClaims = claims.filter(c => c.holder_name === u.full_name).length;

                return `
                    <tr class="hover:bg-slate-50/80 transition-colors group">
                        <td class="px-6 py-4 flex items-center gap-3 font-bold text-slate-800">
                            <div class="w-9 h-9 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600 flex items-center justify-center text-white text-[10px] shadow-sm">
                                ${initials}
                            </div>
                            <div>
                                <p>${u.full_name}</p>
                                <div class="flex gap-2 text-[10px] text-slate-400 font-medium uppercase">
                                    <span>${userPolicies} policies</span> • <span>${userClaims} claims</span>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-slate-500 font-medium hidden sm:table-cell">${u.email}</td>
                        <td class="px-6 py-4 text-slate-500 font-medium hidden md:table-cell">${u.phone}</td>
                        <td class="px-6 py-4 text-slate-400 text-xs hidden lg:table-cell font-medium">${u.created_at}</td>
                        <td class="px-6 py-4">
                            <span class="badge-${u.status} px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">${u.status}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <div class="flex justify-end gap-1">
                                <button onclick="openCustomerModal('${u.id}')" class="p-2 text-slate-300 hover:text-slate-600 transition-colors"><i data-lucide="eye" class="w-5 h-5"></i></button>
                                <button class="p-2 text-slate-300 hover:text-emerald-600 transition-colors"><i data-lucide="mail" class="w-5 h-5"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            lucide.createIcons();
        }

        function openCustomerModal(id) {
            const u = customers.find(user => user.id === id);
            const userPolicies = policies.filter(p => p.holder_name === u.full_name);
            const initials = u.full_name.split(" ").map(n => n[0]).join("");

            document.getElementById('m-name').innerText = u.full_name;
            document.getElementById('m-email').innerText = u.email;
            document.getElementById('m-phone').innerText = u.phone;
            document.getElementById('m-joined').innerText = u.created_at;
            document.getElementById('m-avatar').innerText = initials;
            
            const badge = document.getElementById('m-status-badge');
            badge.innerText = u.status;
            badge.className = `badge-${u.status} text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-widest mt-1 inline-block`;

            const list = document.getElementById('m-policies-list');
            if (userPolicies.length === 0) {
                list.innerHTML = '<p class="text-sm text-slate-400 italic">No policies linked to this account.</p>';
            } else {
                list.innerHTML = userPolicies.map(p => `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                        <div>
                            <p class="text-sm font-bold text-slate-800">${p.name}</p>
                            <p class="text-[10px] font-mono text-slate-400 tracking-tighter uppercase">${p.id}</p>
                        </div>
                        <span class="badge-${p.status} px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-widest">${p.status}</span>
                    </div>
                `).join('');
            }

            document.getElementById('customerModal').classList.remove('hidden-modal');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeModal() {
            document.getElementById('customerModal').classList.add('hidden-modal');
            document.body.style.overflow = 'auto';
        }

        // Close on backdrop click
        document.getElementById('customerModal').addEventListener('click', (e) => {
            if (e.target.id === 'customerModal') closeModal();
        });
        function logout() {
    window.location.href = '/logout';
  }

        // Initial Load
        renderCustomers();
    </script>
</body>
</html>